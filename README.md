# Payment
## Задача
Обновлять xlsx-файл так, чтобы сохранялось исходное форматирование: выделение цветом шрифта, заливка ячейки  и заметки. 
Файл представляет собой перечень всех неоплаченных платежей с различными пометками. 
В итоговом файле не должно быть платежей, предназначенных физическим лицам (кроме ИП и самозанятых), в т.ч. нерезидентам РФ, а также некоторые определенные контрагенты из списка.
## Исходные данные
2 файла: перечень всех платежей за предыдущий день (Все платежи на.xlsx) и перечень всех неоплаченных заявок на текущий день (Выгрузка.xlsx)
Необходимо обновить файл со столбцами:
![Screenshot](Наименования_столбцов.jpg)
## Техника решения
### 1. Отбор контрагентов
Для того, чтобы в перечень попали только юридические лица - резиденты РФ, а также ИП и самозанятые, был применен отбор.
```
//python code
pmnts = pmnts[(pmnts['Контрагент'].str.contains('ООО')) | 
              (pmnts['Контрагент'].str.contains('АО')) |
              (pmnts['Контрагент'].str.contains('"'))|
              (pmnts['Контрагент'].str.contains('Самозанят'))|
              (pmnts['Контрагент'].str.contains('самозанят'))|
              (pmnts['Контрагент'].str.contains('ИП'))|
              (pmnts['Контрагент'].isin(individ_grant))|
              (pmnts['Контрагент'].str[0].isin(list))|
              (pmnts['Контрагент'] == "")]
```
В этом отборе поиск контрагетов осуществляется по ключевым словам, характерным для юридических ЛИЦ:
1. Организационно-правовая форма:
   1. **"ООО"**
   2. **"АО"**
2. Наличие кавчек в названии
3. Наличие слов, характеризующих статус ИП и Самозанятого (в названии контрагентов ИП и самозанятых обязательно фигурирует наименование его статуса):
   1. **ИП**
   2. **Самозанят** (без окончаний)
   3. **самозанят** (без окончаний)
Однако некоторые юридические лица, чаще всего гос. учреждения, не имеют в своем наименовании вышеуказанных признаков. Ввиду того, что таких исключений немного добавлен список *individ_grant*. Для пополнения этого списка необходима первая ячейка. Запустив код, получаем список контрагентов, которые будут исключены. При необходимости добавляем контрагентов, которых не нужно исключать в список *individ_grant*.
Также был создан список из латинских прописных букв для фильтрации иностранных контрагентов
```
x = string.ascii_uppercase
list = [ch for ch in x]
```
При этом встречаются иностранные контрагенты - физические лица, наименования которых введены латинскими строными буквами. Таких контрагентов немного, поэтому создан отдельный список *list_foreign*
### 2. Удаление тестовых заявок.
В процессе эксплуатации файла возникла необходимость дополнительного отбора заявок, созданных тех. поддержкой при тестировании функционала. Были выявлены следующие схожие моменты для тестовых заявок
1. Наличие незаполненного поля контрагент, поэтому был добавлен отбор по контрагента
```
pmnts = pmnts[pmnts['Контрагент'] == "")]
```
2. Наличие в описании заявки слова **Удалить**
```
pmnts = pmnts[pmnts['Описание'] != 'Удалить']
```
3. Числа в поле ***Сумма к оплате***: **0.0, 1.0, 2.0, 3.0, 5.0, 10.0, 20.0**, а также наличие слова **Тестов** в поле ***Сделка***
```
pmnts = pmnts[(round(pmnts['Сумма к оплате'], 2) != 0.0)&
              (round(pmnts['Сумма к оплате'], 2) != 1.0)&
              (round(pmnts['Сумма к оплате'], 2) != 10.0)&
              (round(pmnts['Сумма к оплате'], 2) != 20.0)&
              (round(pmnts['Сумма к оплате'], 2) != 3.0)&
              (round(pmnts['Сумма к оплате'], 2) != 2.0)&
              (round(pmnts['Сумма к оплате'], 2) != 5.0)&
              (~pmnts['Сделка'].str.contains('Тестов'))]
```
